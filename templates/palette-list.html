{% extends "base_logged_in.html" %}

{% block title %}Palettes{% endblock %}

{% block flash_script %}
    {% with messages = get_flashed_messages() %}
        {% if messages %}
        <script>
            Swal.fire({
                icon: 'success',
                title: 'Palette Deleted',
                text: '{{ messages[0] }}',
            });
        </script>
        {% endif %}
    {% endwith %}
{% endblock %}

{% block content %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const panel = document.getElementById('palette-options-panel');
        const selectedName = document.getElementById('selected-palette-name');
        const editLink = document.getElementById('edit-link');
        const deleteForm = document.getElementById('delete-form')

        let currentSelectedBox = null;
        let currentSelectedTitle = null;
        console.log("here")

        document.querySelectorAll('.palette-box').forEach(box => {
            const title = box.querySelector('.palette-title');
            console.log("2")
            box.addEventListener('click', () => {
                const paletteName = box.dataset.paletteName;

                // Deselect
                if (currentSelectedBox == box) {
                    panel.classList.add('hidden');
                    if (currentSelectedTitle) {
                        currentSelectedTitle.classList.remove('palette-selected')
                    }
                    currentSelectedBox = null;
                    return;
                }

                // Remove previous
                if (currentSelectedTitle) {
                    currentSelectedTitle.classList.remove('palette-selected');
                }

                currentSelectedBox = box;
                currentSelectedTitle = title;
                panel.classList.remove('hidden');

                currentSelectedTitle.classList.add('palette-selected');
                editLink.setAttribute('href', `/palettes/${encodeURIComponent(paletteName)}/edit`);
                deleteForm.setAttribute('action', `/palettes/${encodeURIComponent(paletteName)}/delete`);

                console.log("setting links")
                // editLink.href = `/palettes/${encodeURIComponent(paletteName)}/edit`;
                // deleteForm.action = `/palettes/${encodeURIComponent(paletteName)}/delete`;
            })
        })
    })
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const deleteBtn = document.getElementById("delete-button");
        const deleteForm = document.getElementById("delete-form");

        deleteBtn.addEventListener("click", () => {
            Swal.fire({
                title: "Delete this palette?",
                text: "This action cannot be undone.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Yes, delete it",
                cancelButtonText: "Cancel"
            }).then((result) => {
                if (result.isConfirmed) {
                    deleteForm.submit();
                }
            });
        });
    });
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const createBtn = document.querySelector(".create-palette-icon");

    createBtn.addEventListener("click", (event) => {
        event.preventDefault();

        Swal.fire({
            title: "Create New Palette",
            input: "text",
            inputLabel: "Palette Name",
            inputPlaceholder: "Enter your palette name",
            showCancelButton: true,
            confirmButtonText: "Create",
            preConfirm: (name) => {
                if (!name) {
                    Swal.showValidationMessage("Palette name is required");
                }
                return name;
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const form = document.createElement("form");
                form.method = "POST";
                form.action = "/create-palette";

                const input = document.createElement("input");
                input.type = "hidden";
                input.name = "palette_name";
                input.value = result.value;

                form.appendChild(input);
                document.body.appendChild(form);
                form.submit();
            }
        });
    });

});
</script>



<div class="palette-main">
    <div class="palettes-container">
        <div class="palettes-grid">
            {% for palette in palettes %}
            <div class="palette-box" data-palette-name="{{ palette['palette_name'] }}">
                <div class="palette-title">
                    <h3>{{ palette['palette_name'] }}</h3>
                </div>

                <div class="palette-colors">
                    {% for color in palette_colors[palette['palette_name']] %}
                    <div class="color-box" style="--box-color: {{ color['hex_value'] }};"></div>
                    {% endfor %}
                </div>
            </div>

            {% endfor %}
        </div>

        <div class="pagination">
            {% if page > 1 %}
            <a href="{{ url_for('palettes', page=page-1)}}">Previous</a>
            {% endif %}

            Page {{ page }} of {{ total_pages }}

            {% if page < total_pages %} <a href="{{ url_for('palettes', page=page+1)}}">Next</a>
                {% endif %}
        </div>
    </div>

    <div class="right-sidebar">
        <div id="palette-options-panel" class="palette-options-panel hidden">
            <a id="edit-link" class="edit-link" href="#">Edit Palette</a>
            <form id="delete-form" method="POST" action="#">
                <button id="delete-button" type="button" class="delete-button">
                    Delete Palette
                </button>
            </form>
        </div>

        <div class="create-palette-panel">
            <a href="/create-palette" class="create-palette-icon" data-tooltip="Create Palette">
                <i class="fas fa-plus-circle"></i>
            </a>
        </div>
    </div>
    
</div>

{% endblock %}